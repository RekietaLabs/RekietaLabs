<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RekietaLabs POS</title>
    <script src="https://cdn.jsdelivr.net/npm/appwrite@13.0.0"></script>
    <style>
        body {
            background-color: #121212;
            color: #ffffff;
            font-family: Arial, sans-serif;
            text-align: center;
        }
        .light-mode {
            background-color: #ffffff;
            color: #121212;
        }
        .container {
            margin-top: 50px;
        }
        .button {
            background-color: #be9f13;
            color: black;
            padding: 15px;
            border: none;
            cursor: pointer;
            margin: 5px;
            font-size: 18px;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>

    <button onclick="toggleTheme()">Toggle Dark/Light Mode</button>

    <div id="login-screen">
        <h1>Enter Store PIN</h1>
        <input type="password" id="pin-input" placeholder="Enter PIN">
        <button class="button" onclick="login()">Login</button>
    </div>

    <div id="pos-system" class="hidden">
        <h1>Welcome, <span id="cashier-name"></span></h1>
        
        <h3>Select Terminal</h3>
        <select id="terminal-select">
            <option value="1">Terminal 1</option>
            <option value="2">Terminal 2</option>
            <option value="3">Terminal 3</option>
            <option value="4">Terminal 4</option>
            <option value="5">Terminal 5</option>
        </select>

        <h3>Items</h3>
        <button class="button" onclick="addItem('Small')">Small Print</button>
        <button class="button" onclick="addItem('Medium')">Medium Print</button>
        <button class="button" onclick="addItem('Large')">Large Print</button>
        <button class="button" onclick="addCustomAmount()">Custom Amount</button>

        <h3>Phone Number (For Account)</h3>
        <input type="text" id="phone-input" placeholder="Enter Phone Number">
        <button class="button" onclick="checkAccount()">Check Account</button>

        <h3>Cart</h3>
        <ul id="cart"></ul>

        <button class="button" onclick="checkout()">Checkout</button>
    </div>

    <script>
        const client = new Appwrite.Client();
        client.setEndpoint("https://cloud.appwrite.io/v1").setProject("rlpos");

        const databases = new Appwrite.Databases(client);
        const databaseId = "rlpossystem";
        const collectionId = "rlusers";

        let currentCashier = "";

        function toggleTheme() {
            document.body.classList.toggle("light-mode");
        }

        function login() {
            const pin = document.getElementById("pin-input").value;
            let cashiers = {
                "2687": "Kellan Rekieta",
                "4646": "Justin Rekieta"
            };

            if (cashiers[pin]) {
                currentCashier = cashiers[pin];
                document.getElementById("cashier-name").innerText = currentCashier;
                document.getElementById("login-screen").classList.add("hidden");
                document.getElementById("pos-system").classList.remove("hidden");
            } else {
                alert("Invalid PIN!");
            }
        }

        function addItem(item) {
            let cart = document.getElementById("cart");
            let listItem = document.createElement("li");
            listItem.innerText = item;
            cart.appendChild(listItem);
        }

        function addCustomAmount() {
            let amount = prompt("Enter custom amount:");
            if (amount) {
                addItem("Custom: $" + amount);
            }
        }

        async function checkAccount() {
            let phone = document.getElementById("phone-input").value;
            if (!phone) {
                alert("Enter a phone number!");
                return;
            }

            try {
                let response = await databases.listDocuments(databaseId, collectionId, [
                    Appwrite.Query.equal("phone", phone)
                ]);

                if (response.total > 0) {
                    alert("User found: " + response.documents[0].first_name + " " + response.documents[0].last_name);
                } else {
                    let createAccount = confirm("No account found. Create one?");
                    if (createAccount) {
                        createNewAccount(phone);
                    }
                }
            } catch (error) {
                console.error("Error checking account:", error);
                alert("Error checking account.");
            }
        }

        async function createNewAccount(phone) {
            let firstName = prompt("Enter first name:");
            let lastName = prompt("Enter last name:");

            try {
                await databases.createDocument(databaseId, collectionId, Appwrite.ID.unique(), {
                    first_name: firstName,
                    last_name: lastName,
                    phone: phone
                });

                alert("Account created successfully!");
            } catch (error) {
                console.error("Error creating account:", error);
                alert("Error creating account.");
            }
        }

        function checkout() {
            alert("Checkout process started. (Next: Connect to Terminal)");
        }
    </script>

</body>
</html>
